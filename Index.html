<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ChamaA√≠ - V√°rzea Alegre CE</title>

<!-- Leaflet (Mapa) -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<style>
:root{
  --verde:#2ecc71;
  --verde-escuro:#27ae60;
  --preto:#1e1e1e;
  --fundo:#f5f7fa;
}

*{box-sizing:border-box;font-family:Arial,Helvetica,sans-serif}
body{margin:0;background:linear-gradient(180deg,var(--verde) 0%, var(--fundo) 60%);color:#0f172a}

/* Topo */
header{
  background:linear-gradient(90deg,var(--preto),var(--verde-escuro));
  color:#fff;
  padding:12px 16px;
  display:flex;
  align-items:center;
  gap:12px
}
header h1{margin:0;font-size:22px}
header small{opacity:.9}

/* Logo */
.logo-box{
  background:#fff;
  padding:10px;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  box-shadow:0 4px 10px rgba(0,0,0,.15)
}
.logo-box img{height:48px;width:auto;display:block}

.container{max-width:1000px;margin:auto;padding:20px}
.card{background:#fff;border-radius:16px;padding:16px;margin-bottom:16px;box-shadow:0 10px 25px rgba(0,0,0,.12)}
.hidden{display:none}
h2{margin-top:0}

input,select,button{
  width:100%;padding:12px;margin-top:10px;
  border-radius:10px;border:1px solid #cbd5e1
}
input:focus,select:focus{
  border-color:var(--verde);
  outline:none;
  box-shadow:0 0 0 2px rgba(46,204,113,.2)
}

button{
  background:var(--verde);
  color:#fff;border:none;font-weight:bold;cursor:pointer
}
button:hover{background:var(--verde-escuro)}

.btn-prestador{background:var(--preto)}
.btn-prestador:hover{background:#000}

.table{width:100%;border-collapse:collapse}
.table th,.table td{padding:8px;border-bottom:1px solid #e5e7eb;text-align:left}

.badge{display:inline-block;background:#22c55e;color:#fff;padding:4px 10px;border-radius:20px;font-size:12px}

/* HERO */
.hero{
  background:url('https://images.unsplash.com/photo-1522202176988-66273c2fd55f?auto=format&fit=crop&w=1200&q=80') center/cover no-repeat;
  border-radius:16px;
  padding:40px 20px;
  color:#fff;
  margin-bottom:20px;
}
.hero h2{font-size:28px;margin:0 0 10px 0}

/* Imagem de card */
.card-img{
  width:100%;
  height:140px;
  object-fit:cover;
  border-radius:12px;
  margin-bottom:10px;
}

/* Mapa */
#map{
  width:100%;
  height:250px;
  border-radius:12px;
  margin:10px 0;
}
</style>
</head>
<body>

<header>
  <div class="logo-box">
    <img src="img/Logo.png" alt="ChamaA√≠">
  </div>
  <div>
    <h1>ChamaA√≠</h1>
    <small>Chamou, chegou. ‚Ä¢ V√°rzea Alegre - CE</small>
  </div>
</header>

<div class="container">

  <!-- HERO -->
  <div class="card hero">
    <h2>Resolva tudo em V√°rzea Alegre com o ChamaA√≠</h2>
  </div>

  <!-- LOGIN -->
  <div class="card" id="loginCard">
    <h2>üîê Entrar</h2>
    <input id="loginUser" placeholder="Usu√°rio / WhatsApp">
    <input id="loginPass" type="password" placeholder="Senha">
    <select id="loginTipo">
      <option value="cliente">Cliente</option>
      <option value="prestador">Prestador</option>
      <option value="admin">Admin</option>
    </select>
    <button onclick="login()">Entrar</button>
    <hr>
    <button class="btn-prestador" onclick="mostrarCadastroPrestador()">üß∞ Quero ser prestador</button>
  </div>

  <!-- CADASTRO PRESTADOR -->
  <div class="card hidden" id="cadastroPrestadorCard">
    <h2>üß∞ Cadastro de Prestador</h2>
    <input id="cadNome" placeholder="Nome completo">
    <input id="cadWhats" placeholder="WhatsApp">
    <input id="cadServico" placeholder="Qual servi√ßo voc√™ faz?">
    <input id="cadBairro" placeholder="Bairro / Regi√£o">
    <input id="cadSenha" type="password" placeholder="Crie uma senha">
    <button onclick="cadastrarPrestador()">üì® Enviar para aprova√ß√£o</button>
    <button class="btn-prestador" onclick="voltarLogin()">‚¨ÖÔ∏è Voltar</button>
  </div>

  <!-- HOME -->
  <div class="card hidden" id="homeCard">
    <h2>üëã Bem-vindo</h2>
    <span class="badge" id="userTipo"></span>
    <button class="btn-prestador" onclick="logout()">Sair</button>
  </div>

  <!-- PEDIDO CLIENTE -->
  <div class="card hidden" id="pedidoCard">
    <h2>üß∞ Pedir um servi√ßo</h2>

    <p>üìç Toque no mapa para marcar o local do servi√ßo:</p>
    <div id="map"></div>
    <input id="localMapa" placeholder="Local selecionado no mapa" readonly>

    <img class="card-img" src="https://images.unsplash.com/photo-1581578731548-c64695cc6952?auto=format&fit=crop&w=800&q=80">

    <input id="nome" placeholder="Seu nome">
    <input id="whats" placeholder="Seu WhatsApp">
    <input id="endereco" placeholder="Endere√ßo ou bairro">
    <input id="servico" placeholder="Qual servi√ßo voc√™ precisa?">
    <input id="valor" type="number" placeholder="Valor combinado (R$)">
    <button onclick="enviarPedido()">üì≤ Chamar agora</button>

    <div style="margin-top:15px;padding:15px;background:#f8fafc;border-radius:12px;">
      <h3>üí≥ Pagamento via Pix</h3>
      <p>Chave Pix:</p>
      <input id="pixKey" readonly>
      <button onclick="copiarPix()">üìã Copiar chave Pix</button>
    </div>
  </div>

  <!-- ADMIN -->
  <div class="card hidden" id="adminCard">
    <h2>üõ†Ô∏è Painel do Admin</h2>

    <h3>üìã Prestadores Pendentes</h3>
    <table class="table">
      <thead>
        <tr><th>Nome</th><th>Servi√ßo</th><th>WhatsApp</th><th>A√ß√£o</th></tr>
      </thead>
      <tbody id="listaPrestadores"></tbody>
    </table>

    <h3 style="margin-top:20px;">üì¶ Pedidos</h3>
    <table class="table">
      <thead>
        <tr><th>Nome</th><th>Servi√ßo</th><th>Valor</th><th>Comiss√£o</th></tr>
      </thead>
      <tbody id="listaPedidos"></tbody>
    </table>
  </div>

</div>

<script>
// CONFIG
const SEU_WHATSAPP = "5588996559062";
const CHAVE_PIX = "88996559062";
const COMISSAO = 0.20;

// ADMIN
const ADMIN_USER = "jose2026";
const ADMIN_PASS = "Jose2026";

// Set Pix
document.getElementById("pixKey").value = CHAVE_PIX;

// Navega√ß√£o
function mostrarCadastroPrestador(){
  loginCard.classList.add("hidden");
  cadastroPrestadorCard.classList.remove("hidden");
}
function voltarLogin(){
  cadastroPrestadorCard.classList.add("hidden");
  loginCard.classList.remove("hidden");
}

// Cadastro prestador
function cadastrarPrestador(){
  const nome = cadNome.value.trim();
  const whats = cadWhats.value.trim();
  const servico = cadServico.value.trim();
  const bairro = cadBairro.value.trim();
  const senha = cadSenha.value;

  if(!nome || !whats || !servico || !bairro || !senha){
    alert("Preencha tudo");
    return;
  }

  let prestadores = JSON.parse(localStorage.getItem("prestadores") || "[]");
  prestadores.push({nome, whats, servico, bairro, senha, aprovado:false});
  localStorage.setItem("prestadores", JSON.stringify(prestadores));

  const msg = `üß∞ Novo cadastro de prestador - ChamaA√≠
Nome: ${nome}
WhatsApp: ${whats}
Servi√ßo: ${servico}
Bairro: ${bairro}

Status: PENDENTE DE APROVA√á√ÉO`;

  window.open(`https://wa.me/${SEU_WHATSAPP}?text=${encodeURIComponent(msg)}`, "_blank");

  alert("Cadastro enviado! Aguarde aprova√ß√£o.");
  voltarLogin();
}

// Login
function login(){
  const user = loginUser.value.trim();
  const pass = loginPass.value;
  const tipo = loginTipo.value;

  if(tipo === "admin"){
    if(user !== ADMIN_USER || pass !== ADMIN_PASS){
      alert("Admin inv√°lido");
      return;
    }
  }

  if(tipo === "prestador"){
    const prestadores = JSON.parse(localStorage.getItem("prestadores") || "[]");
    const p = prestadores.find(p => p.whats === user && p.senha === pass && p.aprovado);
    if(!p){
      alert("Prestador n√£o aprovado ou dados incorretos");
      return;
    }
  }

  localStorage.setItem("userLogado", JSON.stringify({user, tipo}));
  mostrarHome();
}

// Home
function mostrarHome(){
  loginCard.classList.add("hidden");
  cadastroPrestadorCard.classList.add("hidden");
  homeCard.classList.remove("hidden");

  const data = JSON.parse(localStorage.getItem("userLogado"));
  userTipo.innerText = "Logado como: " + data.tipo;

  if(data.tipo === "cliente"){
    pedidoCard.classList.remove("hidden");
  }

  if(data.tipo === "admin"){
    adminCard.classList.remove("hidden");
    carregarPrestadores();
    carregarPedidos();
  }
}

// Admin - Prestadores
function carregarPrestadores(){
  const lista = document.getElementById("listaPrestadores");
  lista.innerHTML = "";
  let prestadores = JSON.parse(localStorage.getItem("prestadores") || "[]");

  prestadores.forEach((p,i) => {
    if(!p.aprovado){
      const tr = document.createElement("tr");
      tr.innerHTML = `<td>${p.nome}</td><td>${p.servico}</td><td>${p.whats}</td>
      <td><button onclick="aprovarPrestador(${i})">Aprovar</button></td>`;
      lista.appendChild(tr);
    }
  });
}

function aprovarPrestador(i){
  let prestadores = JSON.parse(localStorage.getItem("prestadores") || "[]");
  prestadores[i].aprovado = true;
  localStorage.setItem("prestadores", JSON.stringify(prestadores));
  alert("Prestador aprovado!");
  carregarPrestadores();
}

// Pedido
function enviarPedido(){
  const nome = document.getElementById("nome").value.trim();
  const whats = document.getElementById("whats").value.trim();
  const endereco = document.getElementById("endereco").value.trim();
  const servico = document.getElementById("servico").value.trim();
  const valor = parseFloat(document.getElementById("valor").value || 0);
  const comissao = (valor * COMISSAO).toFixed(2);
  const localMapa = document.getElementById("localMapa").value || "N√£o informado";

  if(!nome || !whats || !servico){
    alert("Preencha pelo menos nome, WhatsApp e servi√ßo.");
    return;
  }

  let pedidos = JSON.parse(localStorage.getItem("pedidos") || "[]");
  pedidos.push({nome, servico, valor, comissao});
  localStorage.setItem("pedidos", JSON.stringify(pedidos));

  const msg = `üì¶ Novo pedido - ChamaA√≠
Nome: ${nome}
WhatsApp: ${whats}
Endere√ßo: ${endereco}
Servi√ßo: ${servico}
Valor: R$ ${valor}
Comiss√£o: R$ ${comissao}
üìç Local no mapa: ${localMapa}
Pix: ${CHAVE_PIX}`;

  window.open(`https://wa.me/${SEU_WHATSAPP}?text=${encodeURIComponent(msg)}`, "_blank");
}

// Admin pedidos
function carregarPedidos(){
  const lista = document.getElementById("listaPedidos");
  lista.innerHTML = "";
  let pedidos = JSON.parse(localStorage.getItem("pedidos") || "[]");

  pedidos.forEach(p => {
    const tr = document.createElement("tr");
    tr.innerHTML = `<td>${p.nome}</td><td>${p.servico}</td><td>R$ ${p.valor}</td><td>R$ ${p.comissao}</td>`;
    lista.appendChild(tr);
  });
}

// Pix
function copiarPix(){
  const pixKey = document.getElementById("pixKey");
  pixKey.select();
  pixKey.setSelectionRange(0, 99999);
  document.execCommand("copy");
  alert("Chave Pix copiada!");
}

// Logout
function logout(){
  localStorage.removeItem("userLogado");
  location.reload();
}

// MAPA - V√°rzea Alegre CE
let map = L.map('map').setView([-6.7895, -39.2965], 13);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom: 19 }).addTo(map);

let marker;
map.on('click', function(e){
  const lat = e.latlng.lat.toFixed(5);
  const lng = e.latlng.lng.toFixed(5);

  if(marker){
    marker.setLatLng(e.latlng);
  } else {
    marker = L.marker(e.latlng).addTo(map);
  }
  document.getElementById("localMapa").value = `Lat: ${lat}, Lng: ${lng}`;
});
</script>

</body>
</html>